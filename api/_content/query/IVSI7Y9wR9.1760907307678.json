{"_path":"/tutorials/keycloak-admin-api","_dir":"tutorials","_draft":false,"_partial":false,"_locale":"","title":"Keycloak admin api","description":"Giving access to a realm using service providers","id":"keycloak-admin-api","path":"/tutorials/keycloak-admin-api","created":"2023-11-04","updated":"2023-11-04","author":"Simon Scholz","tags":["keycloak","OAuth","OIDC","Open ID Connect","security","docker","container","admin"],"vgWort":"vg04.met.vgwort.de/na/58263af62f7a4ac782777c0f91985b27","readingTime":{"text":"3 min read","minutes":2.565,"time":153900,"words":513},"body":{"type":"root","children":[{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"In this tutorial we will learn how to use the Keycloak admin API to create a service account and how to use it to access the admin API."}]},{"type":"element","tag":"h2","props":{"id":"prerequisites"},"children":[{"type":"text","value":"Prerequisites"}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"In order to follow this tutorial Docker and docker-compose need to be installed."}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"Also see "},{"type":"element","tag":"a","props":{"href":"https://simonscholz.dev/tutorials/ubuntu-dev-setup#docker-docker-compose","rel":["noopener","noreferer"],"target":"_blank"},"children":[{"type":"text","value":"docker and docker compose"}]},{"type":"text","value":"."}]},{"type":"element","tag":"h2","props":{"id":"start-keycloak-using-docker-compose"},"children":[{"type":"text","value":"Start Keycloak using docker-compose"}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"Please create a "},{"type":"element","tag":"code","props":{"className":[]},"children":[{"type":"text","value":"docker-compose.yaml"}]},{"type":"text","value":" file with the following content:"}]},{"type":"element","tag":"pre","props":{"className":"language-yaml shiki shiki-themes github-light github-dark monokai","code":"version: \"3.7\"\n\nservices:\n  keycloak:\n    image: \"quay.io/keycloak/keycloak:22.0\"\n    container_name: quarkus-keycloak\n    restart: \"no\"\n    ports:\n      - \"8180:8080\" # Changing port because 8080 is often occupied\n    environment:\n      - KEYCLOAK_ADMIN=admin\n      - KEYCLOAK_ADMIN_PASSWORD=admin\n    command:\n      - start-dev\n","filename":"docker-compose.yaml","language":"yaml","meta":"","style":""},"children":[{"type":"element","tag":"code","props":{"__ignoreMap":""},"children":[{"type":"element","tag":"span","props":{"class":"line","line":1},"children":[{"type":"element","tag":"span","props":{"style":"--shiki-default:#22863A;--shiki-dark:#85E89D;--shiki-sepia:#F92672"},"children":[{"type":"text","value":"version"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#24292E;--shiki-dark:#E1E4E8;--shiki-sepia:#F8F8F2"},"children":[{"type":"text","value":": "}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#032F62;--shiki-dark:#9ECBFF;--shiki-sepia:#E6DB74"},"children":[{"type":"text","value":"\"3.7\"\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":2},"children":[{"type":"element","tag":"span","props":{"emptyLinePlaceholder":true},"children":[{"type":"text","value":"\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":3},"children":[{"type":"element","tag":"span","props":{"style":"--shiki-default:#22863A;--shiki-dark:#85E89D;--shiki-sepia:#F92672"},"children":[{"type":"text","value":"services"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#24292E;--shiki-dark:#E1E4E8;--shiki-sepia:#F8F8F2"},"children":[{"type":"text","value":":\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":4},"children":[{"type":"element","tag":"span","props":{"style":"--shiki-default:#22863A;--shiki-dark:#85E89D;--shiki-sepia:#F92672"},"children":[{"type":"text","value":"  keycloak"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#24292E;--shiki-dark:#E1E4E8;--shiki-sepia:#F8F8F2"},"children":[{"type":"text","value":":\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":5},"children":[{"type":"element","tag":"span","props":{"style":"--shiki-default:#22863A;--shiki-dark:#85E89D;--shiki-sepia:#F92672"},"children":[{"type":"text","value":"    image"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#24292E;--shiki-dark:#E1E4E8;--shiki-sepia:#F8F8F2"},"children":[{"type":"text","value":": "}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#032F62;--shiki-dark:#9ECBFF;--shiki-sepia:#E6DB74"},"children":[{"type":"text","value":"\"quay.io/keycloak/keycloak:22.0\"\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":6},"children":[{"type":"element","tag":"span","props":{"style":"--shiki-default:#22863A;--shiki-dark:#85E89D;--shiki-sepia:#F92672"},"children":[{"type":"text","value":"    container_name"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#24292E;--shiki-dark:#E1E4E8;--shiki-sepia:#F8F8F2"},"children":[{"type":"text","value":": "}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#032F62;--shiki-dark:#9ECBFF;--shiki-sepia:#E6DB74"},"children":[{"type":"text","value":"quarkus-keycloak\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":7},"children":[{"type":"element","tag":"span","props":{"style":"--shiki-default:#22863A;--shiki-dark:#85E89D;--shiki-sepia:#F92672"},"children":[{"type":"text","value":"    restart"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#24292E;--shiki-dark:#E1E4E8;--shiki-sepia:#F8F8F2"},"children":[{"type":"text","value":": "}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#032F62;--shiki-dark:#9ECBFF;--shiki-sepia:#E6DB74"},"children":[{"type":"text","value":"\"no\"\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":8},"children":[{"type":"element","tag":"span","props":{"style":"--shiki-default:#22863A;--shiki-dark:#85E89D;--shiki-sepia:#F92672"},"children":[{"type":"text","value":"    ports"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#24292E;--shiki-dark:#E1E4E8;--shiki-sepia:#F8F8F2"},"children":[{"type":"text","value":":\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":9},"children":[{"type":"element","tag":"span","props":{"style":"--shiki-default:#24292E;--shiki-dark:#E1E4E8;--shiki-sepia:#F8F8F2"},"children":[{"type":"text","value":"      - "}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#032F62;--shiki-dark:#9ECBFF;--shiki-sepia:#E6DB74"},"children":[{"type":"text","value":"\"8180:8080\""}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#6A737D;--shiki-dark:#6A737D;--shiki-sepia:#88846F"},"children":[{"type":"text","value":" # Changing port because 8080 is often occupied\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":10},"children":[{"type":"element","tag":"span","props":{"style":"--shiki-default:#22863A;--shiki-dark:#85E89D;--shiki-sepia:#F92672"},"children":[{"type":"text","value":"    environment"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#24292E;--shiki-dark:#E1E4E8;--shiki-sepia:#F8F8F2"},"children":[{"type":"text","value":":\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":11},"children":[{"type":"element","tag":"span","props":{"style":"--shiki-default:#24292E;--shiki-dark:#E1E4E8;--shiki-sepia:#F8F8F2"},"children":[{"type":"text","value":"      - "}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#032F62;--shiki-dark:#9ECBFF;--shiki-sepia:#E6DB74"},"children":[{"type":"text","value":"KEYCLOAK_ADMIN=admin\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":12},"children":[{"type":"element","tag":"span","props":{"style":"--shiki-default:#24292E;--shiki-dark:#E1E4E8;--shiki-sepia:#F8F8F2"},"children":[{"type":"text","value":"      - "}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#032F62;--shiki-dark:#9ECBFF;--shiki-sepia:#E6DB74"},"children":[{"type":"text","value":"KEYCLOAK_ADMIN_PASSWORD=admin\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":13},"children":[{"type":"element","tag":"span","props":{"style":"--shiki-default:#22863A;--shiki-dark:#85E89D;--shiki-sepia:#F92672"},"children":[{"type":"text","value":"    command"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#24292E;--shiki-dark:#E1E4E8;--shiki-sepia:#F8F8F2"},"children":[{"type":"text","value":":\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":14},"children":[{"type":"element","tag":"span","props":{"style":"--shiki-default:#24292E;--shiki-dark:#E1E4E8;--shiki-sepia:#F8F8F2"},"children":[{"type":"text","value":"      - "}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#032F62;--shiki-dark:#9ECBFF;--shiki-sepia:#E6DB74"},"children":[{"type":"text","value":"start-dev\n"}]}]}]}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"Then start Keycloak with:"}]},{"type":"element","tag":"pre","props":{"className":"language-bash shiki shiki-themes github-light github-dark monokai","code":"docker-compose up\n\n# or dependending on your docker-compose version\ndocker compose up\n","language":"bash","meta":"","style":""},"children":[{"type":"element","tag":"code","props":{"__ignoreMap":""},"children":[{"type":"element","tag":"span","props":{"class":"line","line":1},"children":[{"type":"element","tag":"span","props":{"style":"--shiki-default:#6F42C1;--shiki-dark:#B392F0;--shiki-sepia:#A6E22E"},"children":[{"type":"text","value":"docker-compose"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#032F62;--shiki-dark:#9ECBFF;--shiki-sepia:#E6DB74"},"children":[{"type":"text","value":" up\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":2},"children":[{"type":"element","tag":"span","props":{"emptyLinePlaceholder":true},"children":[{"type":"text","value":"\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":3},"children":[{"type":"element","tag":"span","props":{"style":"--shiki-default:#6A737D;--shiki-dark:#6A737D;--shiki-sepia:#88846F"},"children":[{"type":"text","value":"# or dependending on your docker-compose version\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":4},"children":[{"type":"element","tag":"span","props":{"style":"--shiki-default:#6F42C1;--shiki-dark:#B392F0;--shiki-sepia:#A6E22E"},"children":[{"type":"text","value":"docker"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#032F62;--shiki-dark:#9ECBFF;--shiki-sepia:#E6DB74"},"children":[{"type":"text","value":" compose"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#032F62;--shiki-dark:#9ECBFF;--shiki-sepia:#E6DB74"},"children":[{"type":"text","value":" up\n"}]}]}]}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"After Keycloak has started, you can access the admin console at "},{"type":"element","tag":"a","props":{"href":"http://localhost:8180/admin/master/console/","rel":["noopener","noreferer"],"target":"_blank"},"children":[{"type":"text","value":"http://localhost:8180/admin/master/console/"}]},{"type":"text","value":" and login with the credentials "},{"type":"element","tag":"code","props":{"className":[]},"children":[{"type":"text","value":"admin"}]},{"type":"text","value":" and "},{"type":"element","tag":"code","props":{"className":[]},"children":[{"type":"text","value":"admin"}]},{"type":"text","value":"."}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"Note: Running "},{"type":"element","tag":"code","props":{"className":[]},"children":[{"type":"text","value":"docker-compose down"}]},{"type":"text","value":" will shut down the Keycloak container again."}]},{"type":"element","tag":"h2","props":{"id":"create-a-sample-realm"},"children":[{"type":"text","value":"Create a sample realm"}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"In the admin console, click on the realm dropdown menu and click on "},{"type":"element","tag":"code","props":{"className":[]},"children":[{"type":"text","value":"Create realm"}]},{"type":"text","value":"."}]},{"type":"element","tag":"p","props":{},"children":[{"type":"element","tag":"img","props":{"alt":"Create sample realm","src":"/tutorials/keycloak-admin-api/create-realm.png"},"children":[]}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"Then enter a realm name, e.g., "},{"type":"element","tag":"code","props":{"className":[]},"children":[{"type":"text","value":"Simon"}]},{"type":"text","value":" and click on "},{"type":"element","tag":"code","props":{"className":[]},"children":[{"type":"text","value":"Create"}]},{"type":"text","value":"."}]},{"type":"element","tag":"h2","props":{"id":"create-a-client-with-service-account-roles"},"children":[{"type":"text","value":"Create a client with service account roles"}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"In order to access the Keycloak admin API, you need to create a client with "},{"type":"element","tag":"code","props":{"className":[]},"children":[{"type":"text","value":"service account roles"}]},{"type":"text","value":" authentication flow.\nTherefore you need to login to the admin console and navigate to the "},{"type":"element","tag":"code","props":{"className":[]},"children":[{"type":"text","value":"Simon"}]},{"type":"text","value":" realm and then to "},{"type":"element","tag":"code","props":{"className":[]},"children":[{"type":"text","value":"Clients"}]},{"type":"text","value":" and click on "},{"type":"element","tag":"code","props":{"className":[]},"children":[{"type":"text","value":"Create client"}]},{"type":"text","value":"."}]},{"type":"element","tag":"p","props":{},"children":[{"type":"element","tag":"img","props":{"alt":"Create client button","src":"/tutorials/keycloak-admin-api/create-client-button.png"},"children":[]}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"Then you need to enter a client ID, e.g., "},{"type":"element","tag":"code","props":{"className":[]},"children":[{"type":"text","value":"admin-api-sample"}]},{"type":"text","value":" and click on "},{"type":"element","tag":"code","props":{"className":[]},"children":[{"type":"text","value":"Next"}]},{"type":"text","value":"."}]},{"type":"element","tag":"p","props":{},"children":[{"type":"element","tag":"img","props":{"alt":"Create client ID","src":"/tutorials/keycloak-admin-api/create-client-id.png"},"children":[]}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"After clicking "},{"type":"element","tag":"code","props":{"className":[]},"children":[{"type":"text","value":"Next"}]},{"type":"text","value":" you will be in the Capability config section, where the authentication and desired flows are setup."}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"Here we need to enable Client authentication and only select "},{"type":"element","tag":"code","props":{"className":[]},"children":[{"type":"text","value":"Service accounts roles"}]},{"type":"text","value":" and click on "},{"type":"element","tag":"code","props":{"className":[]},"children":[{"type":"text","value":"Next"}]},{"type":"text","value":"."}]},{"type":"element","tag":"p","props":{},"children":[{"type":"element","tag":"img","props":{"alt":"Capability/Auth config","src":"/tutorials/keycloak-admin-api/create-client-auth.png"},"children":[]}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"The last "},{"type":"element","tag":"code","props":{"className":[]},"children":[{"type":"text","value":"Login settings"}]},{"type":"text","value":" section can be left as is and you can click on "},{"type":"element","tag":"code","props":{"className":[]},"children":[{"type":"text","value":"Save"}]},{"type":"text","value":"."}]},{"type":"element","tag":"h2","props":{"id":"set-up-the-service-account-roles"},"children":[{"type":"text","value":"Set up the service account roles"}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"In the clients list there should now be a new client called "},{"type":"element","tag":"code","props":{"className":[]},"children":[{"type":"text","value":"admin-api-sample"}]},{"type":"text","value":". Click on it and navigate to the "},{"type":"element","tag":"code","props":{"className":[]},"children":[{"type":"text","value":"Service Account Roles"}]},{"type":"text","value":" tab."}]},{"type":"element","tag":"p","props":{},"children":[{"type":"element","tag":"img","props":{"alt":"Service account roles","src":"/tutorials/keycloak-admin-api/service-account-roles.png"},"children":[]}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"Here you can add the roles that the service account should have.\nIn this example we will add the "},{"type":"element","tag":"code","props":{"className":[]},"children":[{"type":"text","value":"view-clients"}]},{"type":"text","value":" role by clicking on "},{"type":"element","tag":"code","props":{"className":[]},"children":[{"type":"text","value":"Assign role"}]},{"type":"text","value":"."}]},{"type":"element","tag":"p","props":{},"children":[{"type":"element","tag":"img","props":{"alt":"Assign view clients role","src":"/tutorials/keycloak-admin-api/assign-view-clients-role.png"},"children":[]}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"Be sure the use "},{"type":"element","tag":"code","props":{"className":[]},"children":[{"type":"text","value":"Filter by clients"}]},{"type":"text","value":" in the dropdown menu and then assign the role."}]},{"type":"element","tag":"h2","props":{"id":"getting-an-access-token-to-query-the-admin-api"},"children":[{"type":"text","value":"Getting an access token to query the admin API"}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"I usually use Postman to query the admin API, but you can use any tool you like, e.g., curl."}]},{"type":"element","tag":"pre","props":{"className":"language-bash shiki shiki-themes github-light github-dark monokai","code":"curl --location 'http://localhost:8180/realms/simon/protocol/openid-connect/token' \\\n--header 'Content-Type: application/x-www-form-urlencoded' \\\n--data-urlencode 'grant_type=client_credentials' \\\n--data-urlencode 'client_id=admin-api-sample' \\\n--data-urlencode 'client_secret={your-client-secret}' \\\n","language":"bash","meta":"","style":""},"children":[{"type":"element","tag":"code","props":{"__ignoreMap":""},"children":[{"type":"element","tag":"span","props":{"class":"line","line":1},"children":[{"type":"element","tag":"span","props":{"style":"--shiki-default:#6F42C1;--shiki-dark:#B392F0;--shiki-sepia:#A6E22E"},"children":[{"type":"text","value":"curl"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#005CC5;--shiki-dark:#79B8FF;--shiki-sepia:#AE81FF"},"children":[{"type":"text","value":" --location"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#032F62;--shiki-dark:#9ECBFF;--shiki-sepia:#E6DB74"},"children":[{"type":"text","value":" 'http://localhost:8180/realms/simon/protocol/openid-connect/token'"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#005CC5;--shiki-dark:#79B8FF;--shiki-sepia:#AE81FF"},"children":[{"type":"text","value":" \\\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":2},"children":[{"type":"element","tag":"span","props":{"style":"--shiki-default:#24292E;--shiki-dark:#E1E4E8;--shiki-sepia:#F8F8F2"},"children":[{"type":"text","value":"--header "}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#032F62;--shiki-dark:#9ECBFF;--shiki-sepia:#E6DB74"},"children":[{"type":"text","value":"'Content-Type: application/x-www-form-urlencoded'"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#005CC5;--shiki-dark:#79B8FF;--shiki-sepia:#AE81FF"},"children":[{"type":"text","value":" \\\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":3},"children":[{"type":"element","tag":"span","props":{"style":"--shiki-default:#24292E;--shiki-dark:#E1E4E8;--shiki-sepia:#F8F8F2"},"children":[{"type":"text","value":"--data-urlencode "}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#032F62;--shiki-dark:#9ECBFF;--shiki-sepia:#E6DB74"},"children":[{"type":"text","value":"'grant_type=client_credentials'"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#005CC5;--shiki-dark:#79B8FF;--shiki-sepia:#AE81FF"},"children":[{"type":"text","value":" \\\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":4},"children":[{"type":"element","tag":"span","props":{"style":"--shiki-default:#24292E;--shiki-dark:#E1E4E8;--shiki-sepia:#F8F8F2"},"children":[{"type":"text","value":"--data-urlencode "}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#032F62;--shiki-dark:#9ECBFF;--shiki-sepia:#E6DB74"},"children":[{"type":"text","value":"'client_id=admin-api-sample'"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#005CC5;--shiki-dark:#79B8FF;--shiki-sepia:#AE81FF"},"children":[{"type":"text","value":" \\\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":5},"children":[{"type":"element","tag":"span","props":{"style":"--shiki-default:#24292E;--shiki-dark:#E1E4E8;--shiki-sepia:#F8F8F2"},"children":[{"type":"text","value":"--data-urlencode "}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#032F62;--shiki-dark:#9ECBFF;--shiki-sepia:#E6DB74"},"children":[{"type":"text","value":"'client_secret={your-client-secret}'"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#005CC5;--shiki-dark:#79B8FF;--shiki-sepia:#AE81FF"},"children":[{"type":"text","value":" \\\n"}]}]}]}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"You can find the client secret in the "},{"type":"element","tag":"code","props":{"className":[]},"children":[{"type":"text","value":"Credentials"}]},{"type":"text","value":" tab of the "},{"type":"element","tag":"code","props":{"className":[]},"children":[{"type":"text","value":"admin-api-sample"}]},{"type":"text","value":" client."}]},{"type":"element","tag":"p","props":{},"children":[{"type":"element","tag":"img","props":{"alt":"Client secret","src":"/tutorials/keycloak-admin-api/client-secret.png"},"children":[]}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"If you have "},{"type":"element","tag":"a","props":{"href":"https://jqlang.github.io/jq/download/","rel":["noopener","noreferer"],"target":"_blank"},"children":[{"type":"text","value":"jq installed"}]},{"type":"text","value":", you can also directly assign the access token to a variable in bash:"}]},{"type":"element","tag":"pre","props":{"className":"language-bash shiki shiki-themes github-light github-dark monokai","code":"export ACCESS_TOKEN=$(curl --location 'http://localhost:8180/realms/simon/protocol/openid-connect/token' \\\n--header 'Content-Type: application/x-www-form-urlencoded' \\\n--data-urlencode 'grant_type=client_credentials' \\\n--data-urlencode 'client_id=admin-api-sample' \\\n--data-urlencode 'client_secret={your-client-secret}' | jq -r '.access_token')\n","language":"bash","meta":"","style":""},"children":[{"type":"element","tag":"code","props":{"__ignoreMap":""},"children":[{"type":"element","tag":"span","props":{"class":"line","line":1},"children":[{"type":"element","tag":"span","props":{"style":"--shiki-default:#D73A49;--shiki-dark:#F97583;--shiki-sepia:#F92672"},"children":[{"type":"text","value":"export"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#24292E;--shiki-dark:#E1E4E8;--shiki-sepia:#F8F8F2"},"children":[{"type":"text","value":" ACCESS_TOKEN"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#D73A49;--shiki-dark:#F97583;--shiki-sepia:#F92672"},"children":[{"type":"text","value":"="}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#24292E;--shiki-dark:#E1E4E8;--shiki-sepia:#F8F8F2"},"children":[{"type":"text","value":"$("}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#6F42C1;--shiki-dark:#B392F0;--shiki-sepia:#A6E22E"},"children":[{"type":"text","value":"curl"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#005CC5;--shiki-dark:#79B8FF;--shiki-sepia:#AE81FF"},"children":[{"type":"text","value":" --location"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#032F62;--shiki-dark:#9ECBFF;--shiki-sepia:#E6DB74"},"children":[{"type":"text","value":" 'http://localhost:8180/realms/simon/protocol/openid-connect/token'"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#005CC5;--shiki-dark:#79B8FF;--shiki-sepia:#AE81FF"},"children":[{"type":"text","value":" \\\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":2},"children":[{"type":"element","tag":"span","props":{"style":"--shiki-default:#24292E;--shiki-dark:#E1E4E8;--shiki-sepia:#F8F8F2"},"children":[{"type":"text","value":"--header "}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#032F62;--shiki-dark:#9ECBFF;--shiki-sepia:#E6DB74"},"children":[{"type":"text","value":"'Content-Type: application/x-www-form-urlencoded'"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#005CC5;--shiki-dark:#79B8FF;--shiki-sepia:#AE81FF"},"children":[{"type":"text","value":" \\\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":3},"children":[{"type":"element","tag":"span","props":{"style":"--shiki-default:#24292E;--shiki-dark:#E1E4E8;--shiki-sepia:#F8F8F2"},"children":[{"type":"text","value":"--data-urlencode "}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#032F62;--shiki-dark:#9ECBFF;--shiki-sepia:#E6DB74"},"children":[{"type":"text","value":"'grant_type=client_credentials'"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#005CC5;--shiki-dark:#79B8FF;--shiki-sepia:#AE81FF"},"children":[{"type":"text","value":" \\\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":4},"children":[{"type":"element","tag":"span","props":{"style":"--shiki-default:#24292E;--shiki-dark:#E1E4E8;--shiki-sepia:#F8F8F2"},"children":[{"type":"text","value":"--data-urlencode "}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#032F62;--shiki-dark:#9ECBFF;--shiki-sepia:#E6DB74"},"children":[{"type":"text","value":"'client_id=admin-api-sample'"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#005CC5;--shiki-dark:#79B8FF;--shiki-sepia:#AE81FF"},"children":[{"type":"text","value":" \\\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":5},"children":[{"type":"element","tag":"span","props":{"style":"--shiki-default:#24292E;--shiki-dark:#E1E4E8;--shiki-sepia:#F8F8F2"},"children":[{"type":"text","value":"--data-urlencode "}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#032F62;--shiki-dark:#9ECBFF;--shiki-sepia:#E6DB74"},"children":[{"type":"text","value":"'client_secret={your-client-secret}'"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#D73A49;--shiki-dark:#F97583;--shiki-sepia:#F92672"},"children":[{"type":"text","value":" |"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#6F42C1;--shiki-dark:#B392F0;--shiki-sepia:#A6E22E"},"children":[{"type":"text","value":" jq"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#005CC5;--shiki-dark:#79B8FF;--shiki-sepia:#AE81FF"},"children":[{"type":"text","value":" -r"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#032F62;--shiki-dark:#9ECBFF;--shiki-sepia:#E6DB74"},"children":[{"type":"text","value":" '.access_token'"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#24292E;--shiki-dark:#E1E4E8;--shiki-sepia:#F8F8F2"},"children":[{"type":"text","value":")\n"}]}]}]}]},{"type":"element","tag":"h2","props":{"id":"calling-the-admin-api"},"children":[{"type":"text","value":"Calling the admin API"}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"Now that we have an access token, we can use it to query the admin API."}]},{"type":"element","tag":"pre","props":{"className":"language-bash shiki shiki-themes github-light github-dark monokai","code":"curl --location 'http://localhost:8180/admin/realms/simon/clients' \\\n--header 'Authorization: Bearer '$ACCESS_TOKEN | jq\n","language":"bash","meta":"","style":""},"children":[{"type":"element","tag":"code","props":{"__ignoreMap":""},"children":[{"type":"element","tag":"span","props":{"class":"line","line":1},"children":[{"type":"element","tag":"span","props":{"style":"--shiki-default:#6F42C1;--shiki-dark:#B392F0;--shiki-sepia:#A6E22E"},"children":[{"type":"text","value":"curl"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#005CC5;--shiki-dark:#79B8FF;--shiki-sepia:#AE81FF"},"children":[{"type":"text","value":" --location"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#032F62;--shiki-dark:#9ECBFF;--shiki-sepia:#E6DB74"},"children":[{"type":"text","value":" 'http://localhost:8180/admin/realms/simon/clients'"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#005CC5;--shiki-dark:#79B8FF;--shiki-sepia:#AE81FF"},"children":[{"type":"text","value":" \\\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":2},"children":[{"type":"element","tag":"span","props":{"style":"--shiki-default:#24292E;--shiki-dark:#E1E4E8;--shiki-sepia:#F8F8F2"},"children":[{"type":"text","value":"--header "}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#032F62;--shiki-dark:#9ECBFF;--shiki-sepia:#E6DB74"},"children":[{"type":"text","value":"'Authorization: Bearer '"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#24292E;--shiki-dark:#E1E4E8;--shiki-sepia:#F8F8F2"},"children":[{"type":"text","value":"$ACCESS_TOKEN "}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#D73A49;--shiki-dark:#F97583;--shiki-sepia:#F92672"},"children":[{"type":"text","value":"|"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#6F42C1;--shiki-dark:#B392F0;--shiki-sepia:#A6E22E"},"children":[{"type":"text","value":" jq\n"}]}]}]}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"You can also remove the "},{"type":"element","tag":"code","props":{"className":[]},"children":[{"type":"text","value":"| jq"}]},{"type":"text","value":" part if jq is not installed and you will get the raw JSON response."}]},{"type":"element","tag":"h2","props":{"id":"conclusion"},"children":[{"type":"text","value":"Conclusion"}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"With this tutorial you should be able to use the Keycloak admin API to create a service account and use it to query the admin API."}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"In many cases you will want to use the admin API to automate the creation of realms, clients, users, etc. and this tutorial should give you a good starting point.\nYou simply have to adjust the roles for the service accounts accordingly."}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"Also see "},{"type":"element","tag":"a","props":{"href":"https://www.keycloak.org/docs-api/22.0.5/rest-api/index.html","rel":["noopener","noreferer"],"target":"_blank"},"children":[{"type":"text","value":"Keycloak Admin Rest API docs"}]}]},{"type":"element","tag":"h2","props":{"id":"sources"},"children":[{"type":"text","value":"Sources"}]},{"type":"element","tag":"ul","props":{},"children":[{"type":"element","tag":"li","props":{},"children":[{"type":"element","tag":"a","props":{"href":"https://www.keycloak.org/docs-api/22.0.5/rest-api/index.html","rel":["noopener","noreferer"],"target":"_blank"},"children":[{"type":"text","value":"https://www.keycloak.org/docs-api/22.0.5/rest-api/index.html"}]}]},{"type":"element","tag":"li","props":{},"children":[{"type":"element","tag":"a","props":{"href":"https://simonscholz.dev/tutorials/keycloak-realm-export-import","rel":["noopener","noreferer"],"target":"_blank"},"children":[{"type":"text","value":"https://simonscholz.dev/tutorials/keycloak-realm-export-import"}]}]},{"type":"element","tag":"li","props":{},"children":[{"type":"element","tag":"a","props":{"href":"https://www.keycloak.org/guides#getting-started","rel":["noopener","noreferer"],"target":"_blank"},"children":[{"type":"text","value":"https://www.keycloak.org/guides#getting-started"}]}]}]},{"type":"element","tag":"style","props":{},"children":[{"type":"text","value":"html .default .shiki span {color: var(--shiki-default);background: var(--shiki-default-bg);font-style: var(--shiki-default-font-style);font-weight: var(--shiki-default-font-weight);text-decoration: var(--shiki-default-text-decoration);}html .shiki span {color: var(--shiki-default);background: var(--shiki-default-bg);font-style: var(--shiki-default-font-style);font-weight: var(--shiki-default-font-weight);text-decoration: var(--shiki-default-text-decoration);}html .dark .shiki span {color: var(--shiki-dark);background: var(--shiki-dark-bg);font-style: var(--shiki-dark-font-style);font-weight: var(--shiki-dark-font-weight);text-decoration: var(--shiki-dark-text-decoration);}html.dark .shiki span {color: var(--shiki-dark);background: var(--shiki-dark-bg);font-style: var(--shiki-dark-font-style);font-weight: var(--shiki-dark-font-weight);text-decoration: var(--shiki-dark-text-decoration);}html .sepia .shiki span {color: var(--shiki-sepia);background: var(--shiki-sepia-bg);font-style: var(--shiki-sepia-font-style);font-weight: var(--shiki-sepia-font-weight);text-decoration: var(--shiki-sepia-text-decoration);}html.sepia .shiki span {color: var(--shiki-sepia);background: var(--shiki-sepia-bg);font-style: var(--shiki-sepia-font-style);font-weight: var(--shiki-sepia-font-weight);text-decoration: var(--shiki-sepia-text-decoration);}"}]}],"toc":{"title":"","searchDepth":3,"depth":3,"links":[{"id":"prerequisites","depth":2,"text":"Prerequisites"},{"id":"start-keycloak-using-docker-compose","depth":2,"text":"Start Keycloak using docker-compose"},{"id":"create-a-sample-realm","depth":2,"text":"Create a sample realm"},{"id":"create-a-client-with-service-account-roles","depth":2,"text":"Create a client with service account roles"},{"id":"set-up-the-service-account-roles","depth":2,"text":"Set up the service account roles"},{"id":"getting-an-access-token-to-query-the-admin-api","depth":2,"text":"Getting an access token to query the admin API"},{"id":"calling-the-admin-api","depth":2,"text":"Calling the admin API"},{"id":"conclusion","depth":2,"text":"Conclusion"},{"id":"sources","depth":2,"text":"Sources"}]}},"_type":"markdown","_id":"content:tutorials:keycloak-admin-api:index.md","_source":"content","_file":"tutorials/keycloak-admin-api/index.md","_stem":"tutorials/keycloak-admin-api/index","_extension":"md"}